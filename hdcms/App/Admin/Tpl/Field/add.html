<load file="__STATIC__/header.html"/>
<script>
    //验证
    $(function () {
        //表单验证
        $("form").validation({
            //验证规则
            rules: {
                field_name: {
                    message: {default: "只能由英文字母、数字或下划线组成", empty: "请输入字段名称", success: "字段名设置正确", error: "字段已经存在或设置错误"},
                    rule: {required: true, regexp: /^[a-z0-9_]+$/}
                },
                title: {
                    message: {default: "例：文章标题,请输入中文", empty: "请输入字段标题", "error": "必须输入标题"},
                    rule: {required: true}
                },
                description: {
                    message: {default: "模型描述(可以输入中文)"}
                }
            }
        });
    })
    //验证select选择器
    $(function () {
        $(".validation_select").change(function () {
            var reg = $(this).val();
            $(this).prev().val(reg);
        })
    })
    $(function () {
        $("#field_select").change(function () {
            var fieldType = $(this).val();
            $("table.fieldParam").removeClass("action").addClass("recycle");
            var _table = $("table[lab='" + fieldType + "']");//表格
            _table.removeClass("recycle").addClass("action");
            $("table.fieldParam input").removeAttr("checked");
            switch (fieldType) {
                case "input":
                    _table.find("input[name='field_type']").eq(0).click();//字段类型
                    _table.find("input[name='set[ispasswd]']").eq(1).click();//是否为密码
                    _table.find("input[name='required']").eq(1).click();//是否必须输入
                    break;
                case "textarea":
                    _table.find("input[name='field_type']").eq(0).click();//字段类型
                    _table.find("input[name='required']").eq(1).click();//是否必须输入
                    break;
                case "num":
                    _table.find("input[name='required']").eq(1).click();//是否必须输入
                    break;
                case "datetime":
                    _table.find("input[name='field_type']").eq(0).click();//格式设置
                    _table.find("input[name='required']").eq(1).click();//是否必须输入
                    break;
                case "select":
                    _table.find("input[name='set[type]']").eq(0).click();//格式设置
                    _table.find("input[name='required']").eq(1).click();//是否必须输入
                    break;
                case "editor":
                    _table.find("input[name='set[type]']").eq(1).click();//格式设置
                    break;
            }
        });
        $("#field_select").trigger("change");
    });
    //添加字段发送表单
    $(function () {
        $("form").submit(function () {
            $("#recycle").append($("#field_set_table table.recycle"));
            var _data = $("form").serialize();
            $.ajax({
                url: "",
                data: _data,
                async: false,
                type: "POST",
                dataType: "JSON",
                success: function (data) {
                    if (data.stat == 1) {
                        alert("字段添加成功");
                        location.href = '{|U:"index",array("mid"=>$model['mid'])}';
                    } else {
                        alert(data.msg);
                        $("#field_set_table").append($("#recycle table.recycle"));
                    }
                }
            });
            return false;
        })
    })
</script>
<style type="text/css">
    table.fieldParam {
        border: none;
        display: none;
    }
    table.fieldParam.action {
        display: block;
    }
</style>
</head>
<body>
<div class="right_content">
<div class="menu">
    <a href="{|U:add,array('mid'=>$_GET['mid'])}"
    <if value='METHOD==add'>class='action'</if>
    >添加字段</a> <span>|</span>
    <a href="{|U:'index',array('mid'=>$_GET['mid'])}"
    <if value='METHOD==index'>class='action'</if>
    >字段列表</a>
</div>
<div class="content">
<form action="{|U:'add'}" method="post">
<input type="hidden" name="mid" value="{$model.mid}"/>
<table class="table">
    <tr>
        <td style="text-align:right;width:300px;">字段类型</td>
        <td>
            <select id="field_select" name="show_type">
                <option value="input">单行文本</option>
                <option value="textarea">多行文本</option>
                <option value="num">数字</option>
                <option value="select">选项</option>
                <option value="editor">编辑器</option>
                <option value="image">图片</option>
                <option value="datetime">日期与时间</option>
            </select>
        </td>
    </tr>
    <if value="$model.type==1">
        <tr>
            <td style="text-align:right;">作为主表字段</td>
            <td>
                <input type="radio" name="is_main_table" value="1"/> 是
                <input type="radio" name="is_main_table" value="0" checked="checked"/> 否
            </td>
        </tr>
        <else>
            <input type="hidden" name="is_main_table" value="1"/>
    </if>
    <tr>
        <td style="text-align:right;">
            <span class="star">*</span>字段标题
        </td>
        <td>
            <input type="text" name="title" class="w200"/>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            <span class="star">*</span>字段名
        </td>
        <td>
            <input type="text" name="field_name" class="w200"/>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            字段提示
        </td>
        <td>
            <textarea name="message" style="width:350px;height:60px;"></textarea>
                        <span class="validation">
                    表单输入提示信息
                </span>
        </td>
    </tr>
</table>
<div id="field_set_table">
<!------------------------input------------------------>
<table class="table fieldParam action" lab="input">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table>
                <tr>
                    <td style="width:100px;">文本框长度</td>
                    <td><input type="text" name="set[size]" class="w200" value="30"/></td>
                </tr>
                <tr>
                    <td style="width:100px;">默认值</td>
                    <td><input type="text" name="set[default]" class="w200"/></td>
                </tr>
                <tr>
                    <td style="width:100px;">字段类型</td>
                    <td>
                        <input type="radio" name="field_type" value="char"/> char
                        <input type="radio" name="field_type" value="varchar"/> varchar
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">字段长度</td>
                    <td><input type="text" name="field_size" class="w200" value="50"/></td>
                </tr>
                <tr>
                    <td style="width:100px;">是否为密码</td>
                    <td><input type="radio" name="set[ispasswd]" value="1"/> 是
                        <input type="radio" name="set[ispasswd]" value="0"/> 否
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            表单样式名
        </td>
        <td>
            <input type="text" name="css" class="w100"/>
                        <span class="validation">
                    定义表单的CSS样式名
                </span>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            表单验证
        </td>
        <td>
            <input type="text" name="validation" class="w250"/>
            <select class="validation_select">
                <option value="">验证规则</option>
                <option value="/^\d+$/">数字</option>
                <option value="/^(http[s]?:)?(\/{2})?([a-z0-9]+\.)?[a-z0-9]+(\.(com|cn|cc|org|net|com.cn))$/i">
                    网址
                </option>
                <option value="/(?:\(\d{3,4}\)|\d{3,4}-?)\d{8}/">电话</option>
                <option value="/^\d{11}$/">手机</option>
                <option value="/^[0-9]{1,20}$/">QQ</option>
            </select>
                        <span class="validation">
                                    系统将通过此正则校验表单提交的数据合法性，如果不想校验数据请留空
                        </span>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            必须输入
        </td>
        <td>
            <input type="radio" name="required"/> 是
            <input type="radio" name="required" checked="checked"/> 否
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            数据校验未通过的提示信息
        </td>
        <td>
            <input type="text" name="error" class="w300"/>
        </td>
    </tr>
</table>
<!------------------------input------------------------>

<!------------------------textarea------------------------>
<table class="table fieldParam" lab="textarea">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table>
                <tr>
                    <td style="width:100px;">宽度</td>
                    <td><input type="text" name="set[width]" class="w100" value="400"/> px</td>
                </tr>
                <tr>
                    <td style="width:100px;">高度</td>
                    <td><input type="text" name="set[height]" class="w100" value="80"/> px</td>
                </tr>
                <tr>
                    <td style="width:100px;">默认值</td>
                    <td><textarea cols="50" rows="3" name="set[default]"></textarea></td>
                </tr>
                <tr>
                    <td style="width:100px;">字段类型</td>
                    <td>
                        <input type="radio" name="field_type" value="char"/> char
                        <input type="radio" name="field_type" value="varchar"/> varchar
                        <input type="radio" name="field_type" value="text"/> text
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            表单样式名
        </td>
        <td>
            <input type="text" name="css" class="w100"/>
                        <span class="validation">
                    定义表单的CSS样式名
                </span>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            表单验证
        </td>
        <td>
            <input type="text" name="validation" class="w250"/>
            <select class="validation_select">
                <option value="/^\d+$/">验证规则</option>
                <option value="/^\d+$/">数字</option>
                <option value="/^(http[s]?:)?(\/{2})?([a-z0-9]+\.)?[a-z0-9]+(\.(com|cn|cc|org|net|com.cn))$/i">
                    网址
                </option>
                <option value="/(?:\(\d{3,4}\)|\d{3,4}-?)\d{8}/">电话</option>
                <option value="/^\d{11}$/">手机</option>
                <option value="/^[0-9]{1,20}$/">QQ</option>
            </select>
                        <span class="validation">
                                    系统将通过此正则校验表单提交的数据合法性，如果不想校验数据请留空
                        </span>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            必须输入
        </td>
        <td>
            <input type="radio" name="required"/> 是
            <input type="radio" name="required" checked="checked"/> 否
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            数据校验未通过的提示信息
        </td>
        <td>
            <input type="text" name="error" class="w300"/>
        </td>
    </tr>
</table>
<!------------------------textarea------------------------>

<!------------------------num------------------------>
<table class="table fieldParam" lab="num">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table>
                <tr>
                    <td style="width:100px;">整数位</td>
                    <td><input type="text" name="set[integer]" class="w100" value="5"/></td>
                </tr>
                <tr>
                    <td style="width:100px;">小数位</td>
                    <td><input type="text" name="set[decimal]" value="0" class="w100">
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">默认值</td>
                    <td>
                        <input type="text" name="set[default]" class="w100"/>
                        <input type="hidden" name="field_type" value="decimal"/></td>
                </tr>
                <tr>
                    <td style="width:100px;">文本框长度</td>
                    <td><input type="text" name="set[size]" class="w100" value="30"/> px</td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            表单样式名
        </td>
        <td>
            <input type="text" name="css" class="w100"/>
                        <span class="validation">
                    定义表单的CSS样式名
                </span>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            表单验证
        </td>
        <td>
            <input type="text" name="validation" class="w250"/>
            <select class="validation_select">
                <option value="/^\d+$/">验证规则</option>
                <option value="/^\d+$/">数字</option>
                <option value="/^(http[s]?:)?(\/{2})?([a-z0-9]+\.)?[a-z0-9]+(\.(com|cn|cc|org|net|com.cn))$/i">
                    网址
                </option>
                <option value="/(?:\(\d{3,4}\)|\d{3,4}-?)\d{8}/">电话</option>
                <option value="/^\d{11}$/">手机</option>
                <option value="/^[0-9]{1,20}$/">QQ</option>
            </select>
                        <span class="validation">
                                    系统将通过此正则校验表单提交的数据合法性，如果不想校验数据请留空
                        </span>
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            必须输入
        </td>
        <td>
            <input type="radio" name="required"/> 是
            <input type="radio" name="required" checked="checked"/> 否
        </td>
    </tr>
    <tr>
        <td style="text-align:right;">
            数据校验未通过的提示信息
        </td>
        <td>
            <input type="text" name="error" class="w300"/>
        </td>
    </tr>
</table>
<!------------------------num------------------------>

<!------------------------datetime------------------------>
<table class="table fieldParam" lab="datetime">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table class="set" lab="datetime">
                <tr>
                    <td style="width:100px;">格式设置</td>
                    <td>
                        <input type="radio" name="field_type" value="date"/> 日期 (2013-6-18)<br/>
                        <input type="radio" name="field_type" value="datetime"/> 日期+时间 (2013-6-18 16:22:28)<br/>
                        <input type="radio" name="field_type" value="int"/> 数字 (2013-6-18 16:22:28)
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">文本框长度</td>
                    <td><input type="text" name="set[size]" class="w100" value="30"/> px
                </tr>
            </table>
        </td>
    </tr>
</table>
<!------------------------datetime------------------------>

<!------------------------select------------------------>
<table class="table fieldParam" lab="select">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table>
                <tr>
                    <td style="width:100px;">选项类型</td>
                    <td>
                        <input type="radio" name="set[type]" value="radio"/> 单选框
                        <input type="radio" name="set[type]" value="checkbox"/> 多选框
                        <input type="radio" name="set[type]" value="select"/> 下拉列表
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">选项列表</td>
                    <td><textarea cols="50" rows="3" name="set[param]">选项名称1|选项值1,选项名称2|选项值2</textarea></td>
                </tr>
                <tr>
                    <td style="width:100px;">默认值</td>
                    <td>
                        <input type="text" name="set[default]" class="w200"/>
                        <input type="hidden" name="field_type" value="tinyint"/>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
<!------------------------select------------------------>

<!------------------------editor------------------------>
<table class="table fieldParam" lab="editor">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table>
                <tr>
                    <td style="width:100px;">样式</td>
                    <td>
                        <input type="radio" name="set[type]" value="small"/> 精简
                        <input type="radio" name="set[type]" value="full"/> 完整
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">默认值</td>
                    <td>
                        <textarea cols="50" rows="3" name="set[default]"></textarea>
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">编辑器高度</td>
                    <td>
                        <input type="text" name="set[height]" value="200" class="w100"/> px
                        <input type="hidden" name="field_type" value="text"/>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
<!---------------------------editor-------------------------->

<!---------------------------image--------------------------->
<table class="table fieldParam" lab="image">
    <tr class="input action">
        <td style="text-align:right;width:300px;border-top:none;">
            参数
        </td>
        <td style="border-top:none;">
            <table>
                <tr>
                    <td style="width:100px;">允许大小</td>
                    <td>
                        <input type="text" name="set[upload_size]" value="5" class="w100"/> MB
                    </td>
                </tr>
                <tr>
                    <td style="width:100px;">允许上传图片类型</td>
                    <td>
                        <input type="text" name="set[allow_upload_type]" value="*.gif;*.jpg;*.png;*.jpeg" class="w300"/>
                        <input type="hidden" name="set[default]" value=""/>
                        <input type="hidden" name="field_type" value="char"/>
                        <input type="hidden" name="field_size" value="200"/>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</div>
<!---------------------------num--------------------------->
<input type="submit" class="btn" value="添加字段" style="margin-top:20px;margin-left:20px;"/>
</form>
<!--放置不用的表单元素-->
<div id="recycle" style="display:none;"></div>
</div>
</div>
</body>
</html>