<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <css file="__STATIC__/Css/common.css"/>
    <css file="__CONTROL_TPL__/Css/article.css"/>
    <title>文章列表</title>
    <jquery/>
    <jsconst/>
    <hdui/>
    <script>
        $(function () {
            $("input[name='select_all']").click(function () {
                if ($(this).attr("checked")) {
                    $("input[name='aids[]']").attr("checked", "checked");
                } else {
                    $("input[name='aids[]']").removeAttr("checked");
                }
            })
        })
        /**
         * 删除文章
         * @param aid 文章id
         */
        function delArticle(aid) {
            if (aid) {//删除单篇文章
                aids = {'aids[]': aid};
            } else {//批量删除
                var aids = $("input[name='aids[]']").serialize();
            }
            $.post("__CONTROL__&m=del&mid={$hd.get.mid}", aids, function (data) {
                if (data) {
                    alert("文章删除成功");
                    location.href = data.url;
                } else {
                    alert("文章删除失败");
                }
                location.reload(true);
            })
            return false;
        }
    </script>
</head>
<body>
<div class="search">
    <form action="{|U:'index',array('mid'=>$_GET['mid'])}" method="post">

        <ul>
            <li>
                <select name="cid">
                    <option value="">==选择栏目==</option>
                    <list from="$category" name="c">
                        <option value="{$c.cid}">{$c.catname}</option>
                    </list>
                </select>
            </li>
            <li>
                作者: <input type="text" name="author" class="w80"/>
            </li>
            <li>
                <select name="order">
                    <option value="">==排序==</option>
                    <option value="updatetime">更新时间</option>
                    <option value="click">点击次数</option>
                </select>
            </li>
            <li>
                属性:
                <select name="fid">
                    <option value="">==属性==</option>
                    <list from="$flag" name="f">
                        <option value="{$f.fid}">{$f.flagname}</option>
                    </list>
                </select>
            </li>
            <li>
                <input type="submit" value="搜索" class="btn1"/>
            </li>
        </ul>
    </form>
</div>
<div class="right_content">
    <div class="menu">
        <a href="#" class="action">内容列表</a> <span>|</span>
        <a href="{|U:add,array('mid'=>$_GET['mid'])}<if value='$hd.get.cid'>&cid={$hd.get.cid}</if>"
        <if value='METHOD=="add"'>class='action'</if>
        >添加文章</a>
    </div>
    <div class="content">
        <table class="table table-title">
            <thead>
            <tr>
                <td width="30"><input type="checkbox" name="select_all"/></td>
                <td width="30">id</td>
                <td>标题</td>
                <td width="80">学生</td>
                <td width="100">所属栏目</td>
                <td width="150">更新时间</td>
                <td width="60">点击</td>
                <td width="80">发布人</td>
                <td width="100">操作</td>
            </tr>
            </thead>
            <tbody>
            <list from="$content" name="c">
                <tr>
                    <td><input type="checkbox" name="aids[]" value="{$c.aid}"/></td>
                    <td>{$c.aid}</td>
                    <td>
                        <a href="{|U:'Index/Index/article',array('aid'=>$c['aid'],'mid'=>$c['mid'],'cid'=>$c['cid'])}"
                           target="_blank">{$c.title|mb_substr:0,26,"utf8"}</a>
                        <span>
                            <?php $flag=getArticleFlag($c['aid'],$c['cid'],$c['mid']);
                            if($flag){
                                $_flag_show='[<span style="color:#a40000;">';
                                foreach($flag as $f){
                                    $_flag_show.=$f["flagname"].',';
                                }
                                echo rtrim($_flag_show,',').'</span>]';
                        }
                        ?>
                        </span>
                    </td>
                    <td width="80">
                        <a href="{|U:'index',array('mid'=>$_GET['mid'],'stu_uid'=>$c['stu_uid'])}">{|getStuName:$c['stu_uid']}</a>
                    </td>
                    <td>
                        <a href="{|U:'index',array('cid'=>$c['cid'],'mid'=>$c['mid'])}">
                            {$c.catname}
                        </a>
                    </td>
                    <td>{$c.updatetime|date:"Y-m-d h:i",@@}</td>
                    <td>{$c.click}</td>
                    <td>
                        <a href="{|U:'index',array('author'=>$c['username'])}">{$c.username}</a>
                    </td>
                    <td>
                        <a href="{|U:'Index/Index/article',array('aid'=>$c['aid'],'mid'=>$c['mid'],'cid'=>$c['cid'])}"
                           target="_blank">预览</a> |
                        <a href="{|U:'edit',array('aid'=>$c['aid'],'mid'=>$c['mid'],'cid'=>$c['cid'])}">修改</a> |
                        <a href="javascript:;"
                           onclick="return confirm('确定删除文章【{$c.title}】吗？')?delArticle({$c.aid}):false">删除</a>
                    </td>
                </tr>
            </list>
            </tbody>
        </table>
    </div>
    <?php if(!empty($content)):?>
        <div style="float:left; margin-top:20px;">
            <input type="button" class="btn1" onclick="return confirm('确定删除文章吗？')?delArticle():false;" value="删除"/>
        </div>
        <div class="page1">
            {$page}
        </div>
    <?php endif;?>
</div>
</body>
</html>