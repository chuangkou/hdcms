<load file="__CONTROL_TPL__/header.html"/>
<script>
    //检查备份表时有没有选择表
    $(function () {
        $("form").submit(function () {
            var table = $("input[lab='table']:checked");
            if (table.length == 0) {
                alert("请选择操作的表");
                return false;
            }
        })
    })
    //选择备份表
    $(function () {
        $("input.select_table").click(function () {
            if ($(this).attr("checked") == 'checked') {
                $("input.select_table").attr("checked", true);
                $("input[lab='table']").attr("checked", true);
            } else {
                $("input.select_table").attr("checked", false);
                $("input[lab='table']").attr("checked", false);
            }
        })
    })
    //优化与修复表
    $(function () {
        $("input[lab='optimize']").click(function () {
            $("form").attr({"action": "{|U:'optimize'}"});
        })
        $("input[lab='repair']").click(function () {
            $("form").attr({"action": "{|U:'optimize'}"});
        })
    })
</script>
<form action="{|U:'backup',array('action'=>'backup')}" method="post">
    <table class="table table-title">
        <thead>
        <tr>
            <td width="50">数据备份</td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td width="50">
                <table class="table">
                    <tr>
                        <td class="w100">每次备份条数</td>
                        <td>
                            <input type="text" class="w300" name="row" value="200"/> 条
                        </td>
                    </tr>
                    <tr>
                        <td class="w100">每次备份间隔时间</td>
                        <td>
                            <input type="text" name="time" class="w100" value="1"/> 秒
                        </td>
                    </tr>
                    <tr>
                        <td class="w100"></td>
                        <td>
                            <input type="checkbox" name="backup_structure" checkbox="checkbox" checked="checked"> 备份表结构
                        </td>
                    </tr>
                    <tr>
                        <td class="w100">&nbsp;</td>
                        <td>
                            <input type="submit" class="btn" name="backup" value="开始备份"/>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        </tbody>
    </table>
    <table class="table table-title">
        <thead>
        <tr>
            <td width="50">
                <label><input type="checkbox" class="select_table"/> 反选</label>
            </td>
            <td>表名</td>
            <td>类型</td>
            <td>编码</td>
            <td>记录数</td>
            <td>使用空间</td>
            <td>碎片</td>
            <td width="200">操作</td>
        </tr>
        </thead>
        <tbody>
        <list from="$table.table" name="t">
            <tr>
                <td>
                    <input type="checkbox" name="table[]" value="{$t.tablename}" lab='table'/>
                </td>
                <td>{$t.tablename}</td>
                <td>{$t.engine}</td>
                <td>{$t.charset}</td>
                <td>{$t.rows}</td>
                <td>{$t.size}</td>
                <td>{$t.data_free|default:0}</td>
                <td>
                    <a href="{|U:'optimize',array('table[]'=>$t['tablename'])}">优化</a> |
                    <a href="{|U:'repair',array('table'=>$t['tablename'])}">修复</a>
                </td>
            </tr>
        </list>
        </tbody>
    </table>
    <div class="send" style="margin-left:15px;">
        <label><input type="checkbox" class="select_table"/> <span style='font-size:12px;'>反选</span></label>
        <input type="submit" lab="optimize" value="批量优化" class="btn"/>
        <input type="submit" lab="repair" value="批量修复" class="btn"/>
    </div>
    </div>
</form>
</body>
</html>